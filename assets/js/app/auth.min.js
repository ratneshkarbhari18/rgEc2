// Admin Login Ajax
let adminLoginForm = $("form#adminLogin");
let actionUrl = adminLoginForm.attr("action");

// Ajax Submit Login form
adminLoginForm.submit(function (e) { 
    e.preventDefault();
    $.ajax({
        type: "POST",
        url: actionUrl,
        data: adminLoginForm.serialize(),
        success: function (response) {
            const loginResult = JSON.parse(response);
            if (loginResult.result!="success") {
                $("p#errorMessage").html(loginResult.reason);
            } else {
                window.location.replace(loginResult.redirectUrl);
            }
        }
    });
});


// Customer Login Ajax
let customeLoginForm = $("form#customerLogin");
let actionUrlCustomerLogin = customeLoginForm.attr("action");

// Ajax Submit Login form
customeLoginForm.submit(function (e) { 
    e.preventDefault();
    $.ajax({
        type: "POST",
        url: actionUrlCustomerLogin,
        data: customeLoginForm.serialize(),
        success: function (response) {
            const loginResult = JSON.parse(response);
            if (loginResult.result!="success") {
                $("p#errorMessage").html(loginResult.reason);
            } else {
                window.location.replace(loginResult.redirectUrl);
            }
        }
    });
});

// Sent Verification Email for customer Registration
let customerEmailSubmitForm = $("form#customerRegister");
let actionUrlSendVerifCode = customerEmailSubmitForm.attr("action");



// Ajax submit verif code sending form
customerEmailSubmitForm.submit(function (e) { 
    e.preventDefault();
    $.ajax({
        type: "POST",
        url: actionUrlSendVerifCode,
        data: customerEmailSubmitForm.serialize(),
        success: function (response) {
            if (response!="email-sent") {
                $("p#errorMessage").html("Account with this email already exists else try again later");
            } else {
                customerEmailSubmitForm.addClass("d-none");
                
                let verifyCodeForm = $("form#verifyCode");


                verifyCodeForm.removeClass("d-none");

                verifyCodeForm.submit(function (e) { 
                    e.preventDefault();
                    let verifyCodeFormActionUrl = verifyCodeForm.attr("action");
                    let verifCodeData = verifyCodeForm.serialize();
                    
                    $.ajax({
                        type: "POST",
                        url: verifyCodeFormActionUrl,
                        data: verifCodeData,
                        success: function (response) {
                            const verifyResult = JSON.parse(response);
                            if (verifyResult.result!="success") {
                                $("p#errorMessage").html(verifyResult.reason);
                            } else {
                                // window.location.replace(verifyResult.success_url);

                                verifyCodeForm.addClass("d-none");
                                let setPWdCreateAccountForm = $("form#setPasswordCreateAccountForm");
                                setPWdCreateAccountForm.removeClass("d-none");
                                setPWdCreateAccountForm.submit(function (e) { 
                                    e.preventDefault();
                                    let pwdsSubmitted = setPWdCreateAccountForm.serializeArray();
                                    console.log(pwdsSubmitted);
                                    if (pwdsSubmitted[0]["value"]!=pwdsSubmitted[1]["value"]) {
                                        $("p#errorMessage").html("Passwords dont match");
                                    } else {
                                        $.ajax({
                                            type: "POST",
                                            url: setPWdCreateAccountForm.attr("action"),
                                            data: setPWdCreateAccountForm.serialize(),
                                            success: function (response) {
                                                const registrationData = JSON.parse(response);
                                                if (registrationData.result!="success") {
                                                    $("p#errorMessage").html(registrationData.reason);
                                                } else {
                                                    window.location.replace(registrationData.successUrl);
                                                }
                                            }
                                        });
                                    }
                                });
                            }
                        }
                    });
                });

            }
        }
    });
});

// Show PAssword
$("input#showPwd").click(function (e) { 
    e.preventDefault();
    if ($("input.pwdField").attr("type")=="password") {
        $("input.pwdField").attr("type","text");
    } else {
        $("input.pwdField").attr("type","password");
    }
});